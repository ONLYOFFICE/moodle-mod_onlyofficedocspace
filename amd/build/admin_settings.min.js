/**
 * @module mod_onlyofficedocspace/admin_settings
 * @copyright  2024 Ascensio System SIA <integration@onlyoffice.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 **/
define("mod_onlyofficedocspace/admin_settings",["jquery","mod_onlyofficedocspace/docspace_integration_sdk","mod_onlyofficedocspace/password_generator","mod_onlyofficedocspace/notification","core/str"],(function($,DocspaceIntegrationSdk,PasswordGenerator,Notification,Str){const systemFrameId="oodsp-system-frame";let submitButton;const updateSettings=async function(){const url=document.getElementById("id_s_onlyofficedocspace_docspace_server_url").value,email=document.getElementById("id_s_onlyofficedocspace_docspace_login").value,password=document.getElementsByName("s_onlyofficedocspace_docspace_password")[0].value,hashSettings=await DocSpace.SDK.frames[systemFrameId].getHashSettings(),passwordHash=await DocSpace.SDK.frames[systemFrameId].createHash(password.trim(),hashSettings),randomPasswordHash=await DocSpace.SDK.frames[systemFrameId].createHash(PasswordGenerator.generate(),hashSettings),updateSettingsUrl=M.cfg.wwwroot+"/mod/onlyofficedocspace/api/updateadminsettings.php";let data={url:url,email:email,password:passwordHash,randomPassword:randomPasswordHash};await $.ajax({headers:{Accept:"application/json"},type:"POST",url:updateSettingsUrl,dataType:"json",data:data}).done((async function(response){201===response.status&&window.location.reload()})).fail((function(jqXHR){submitButton.removeAttribute("disabled");const status=jqXHR.status;if(500===status||422===status){const error=jqXHR.responseJSON.error;Notification.display(error,"error")}})),submitButton.removeAttribute("disabled")};return{init:async function(urls){const settingsForm=document.getElementById("adminsettings"),warningMessage=await Str.getString("adminsettings:urlwarning","onlyofficedocspace");if(settingsForm){submitButton=settingsForm.querySelector("[type='submit']");const systemFrameContainer=document.createElement("div");systemFrameContainer.classList.add("d-none");const systemFrame=document.createElement("div");systemFrame.id=systemFrameId,systemFrameContainer.appendChild(systemFrame),settingsForm.appendChild(systemFrameContainer),settingsForm.addEventListener("submit",(async function(event){event.preventDefault(),submitButton.setAttribute("disabled","");const url=document.getElementById("id_s_onlyofficedocspace_docspace_server_url").value.trim();if(urls.current&&url!==urls.current&&url!==urls.default&&!0!==confirm(warningMessage))return void submitButton.removeAttribute("disabled");let script=document.getElementById("oodsp-api-js");script&&script.src!==url+"/"+DocspaceIntegrationSdk.apiUrl&&("undefined"!=typeof DocSpace&&null!==DocSpace&&await DocSpace.SDK.frames[systemFrameId].destroyFrame(),script.remove(),script=null,window.DocSpace=null),script||await DocspaceIntegrationSdk.initScript("oodsp-api-js",url).catch((async()=>{Notification.display(await Str.getString("docspaceunreachable","onlyofficedocspace"),"error")})),"undefined"!=typeof DocSpace&&null!==DocSpace?DocSpace.SDK.frames[systemFrameId]?updateSettings():DocSpace.SDK.initSystem({frameId:systemFrameId,events:{onAppReady:async function(){updateSettings()},onAppError:async function(error){console.log(error),Notification.display(await Str.getString("docspaceapperror","onlyofficedocspace"),"error"),submitButton.removeAttribute("disabled")}}}):submitButton.removeAttribute("disabled")}))}}}}));

//# sourceMappingURL=admin_settings.min.js.map