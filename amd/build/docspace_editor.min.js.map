{"version":3,"file":"docspace_editor.min.js","sources":["../src/docspace_editor.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module mod_onlyofficedocspace/docspace_editor\n * @copyright  2025 Ascensio System SIA <integration@onlyoffice.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\n/* eslint-disable no-undef */\ndefine([\n    'core/str',\n    'core/templates',\n    'jquery',\n    'mod_onlyofficedocspace/docspace_integration_sdk',\n], function(Str, Templates, $, DocSpaceIntegrationSDK) {\n    const createFullScreenButtons = function() {\n        let enterFullScreenText = Str.getString('enterfullscreen', 'onlyofficedocspace');\n        let exitFullScreenText = Str.getString('exitfullscreen', 'onlyofficedocspace');\n        const navLeftButton = $('.drawertoggle')[1];\n        const navRightButton = $('.drawertoggle')[2];\n        const editorContainer = $('.ds-editor-container')[0];\n\n        $.when(enterFullScreenText).done(function(localized) {\n            enterFullScreenText = localized;\n            const enterButton = document.createElement('button');\n            const enterIcon = document.createElement('i');\n            enterIcon.className = 'icon fa fa-expand fa-fw';\n            enterButton.appendChild(enterIcon);\n            enterButton.className = 'ds-editor-fs-button';\n            enterButton.id = 'ds-editor-enter-fs-button';\n            enterButton.innerHTML += enterFullScreenText;\n\n            enterButton.onclick = function() {\n                $('header').hide();\n                $('footer').hide();\n                if (navLeftButton && navLeftButton.getAttribute('data-aria-hidden-tab-index') === null) {\n                    $(navLeftButton).click();\n                }\n                if (navRightButton && navRightButton.getAttribute('data-aria-hidden-tab-index') === null) {\n                    $(navRightButton).click();\n                }\n                if ($('.editmode-switch-form').length > 0 && $('.editmode-switch-form')[0][0].checked) {\n                    $(editorContainer).addClass('ds-editor-rightindent');\n                }\n                $(editorContainer).addClass('ds-editor-fullscreen');\n                editorContainer.children[0].style.height = '93vh';\n                $('#ds-editor-enter-fs-button').hide();\n                $('#ds-editor-exit-fs-button').show();\n            };\n            document.querySelector(\"#page-content h2\").style.display = \"inline-block\";\n            editorContainer.before(enterButton);\n        });\n        $.when(exitFullScreenText).done(function(localized) {\n            exitFullScreenText = localized;\n            const exitButton = document.createElement('button');\n            const exitIcon = document.createElement('i');\n            exitIcon.className = 'icon fa fa-compress fa-fw';\n            exitButton.appendChild(exitIcon);\n            exitButton.innerHTML += exitFullScreenText;\n            exitButton.className = 'ds-editor-fs-button';\n            exitButton.id = 'ds-editor-exit-fs-button';\n\n            exitButton.onclick = function() {\n                $(editorContainer).removeClass('ds-editor-fullscreen');\n                $(editorContainer).removeClass('ds-editor-rightindent');\n                editorContainer.children[0].style.height = '95vh';\n                $('header').show();\n                $('footer').show();\n                $('#ds-editor-enter-fs-button').show();\n                $('#ds-editor-exit-fs-button').hide();\n            };\n            $('#usernavigation')[0].prepend(exitButton);\n            $('#ds-editor-exit-fs-button').hide();\n        });\n    };\n\n    return {\n        init: async function(docspaceUrl, config, user, errorTemplateName) {\n            config.events = {\n                onNotFound: () => {\n                    // eslint-disable-next-line promise/catch-or-return\n                    Templates.renderForPromise(errorTemplateName, {})\n                        .then(({html, js}) => {\n                            DocSpace.SDK.frames[config.frameId].destroyFrame();\n                            Templates.appendNodeContents('#ds-editor-error', html, js);\n                            return;\n                        });\n                },\n            };\n            await DocSpaceIntegrationSDK.initScript('oodsp-api-js', docspaceUrl)\n                // eslint-disable-next-line promise/always-return\n                .then(async() => {\n                    DocSpace.SDK.initSystem({\n                        src: docspaceUrl,\n                        frameId: config.frameId,\n                        width: config.width,\n                        height: config.height,\n                        events: {\n                            onAppReady: async function() {\n                                const docSpace = DocSpace.SDK.frames[config.frameId];\n                                const currentUser = await docSpace.getUserInfo();\n\n                                if ((!user && currentUser) || (currentUser && currentUser.email !== user.email)) {\n                                    await docSpace.logout();\n                                }\n\n                                if (user && user.hash) {\n                                    await docSpace.login(user.email, user.hash);\n                                }\n\n                                docSpace.initFrame(config);\n                            }\n                        }\n                    });\n                });\n            if (config.mode === \"editor\") {\n                createFullScreenButtons();\n            }\n        }\n    };\n});\n/* eslint-enable no-undef */"],"names":["define","Str","Templates","$","DocSpaceIntegrationSDK","init","async","docspaceUrl","config","user","errorTemplateName","events","onNotFound","renderForPromise","then","_ref","html","js","DocSpace","SDK","frames","frameId","destroyFrame","appendNodeContents","initScript","initSystem","src","width","height","onAppReady","docSpace","currentUser","getUserInfo","email","logout","hash","login","initFrame","mode","enterFullScreenText","getString","exitFullScreenText","navLeftButton","navRightButton","editorContainer","when","done","localized","enterButton","document","createElement","enterIcon","className","appendChild","id","innerHTML","onclick","hide","getAttribute","click","length","checked","addClass","children","style","show","querySelector","display","before","exitButton","exitIcon","removeClass","prepend","createFullScreenButtons"],"mappings":";;;;;AAqBAA,gDAAO,CACH,WACA,iBACA,SACA,oDACD,SAASC,IAAKC,UAAWC,EAAGC,8BA8DpB,CACHC,KAAMC,eAAeC,YAAaC,OAAQC,KAAMC,mBAC5CF,OAAOG,OAAS,CACZC,WAAY,KAERV,UAAUW,iBAAiBH,kBAAmB,IACzCI,MAAKC,WAACC,KAACA,KAADC,GAAOA,SACVC,SAASC,IAAIC,OAAOZ,OAAOa,SAASC,eACpCpB,UAAUqB,mBAAmB,mBAAoBP,KAAMC,eAKjEb,uBAAuBoB,WAAW,eAAgBjB,aAEnDO,MAAKR,UACFY,SAASC,IAAIM,WAAW,CACpBC,IAAKnB,YACLc,QAASb,OAAOa,QAChBM,MAAOnB,OAAOmB,MACdC,OAAQpB,OAAOoB,OACfjB,OAAQ,CACJkB,WAAYvB,uBACFwB,SAAWZ,SAASC,IAAIC,OAAOZ,OAAOa,SACtCU,kBAAoBD,SAASE,gBAE7BvB,MAAQsB,aAAiBA,aAAeA,YAAYE,QAAUxB,KAAKwB,cAC/DH,SAASI,SAGfzB,MAAQA,KAAK0B,YACPL,SAASM,MAAM3B,KAAKwB,MAAOxB,KAAK0B,MAG1CL,SAASO,UAAU7B,eAKnB,WAAhBA,OAAO8B,MApGa,eACxBC,oBAAsBtC,IAAIuC,UAAU,kBAAmB,sBACvDC,mBAAqBxC,IAAIuC,UAAU,iBAAkB,4BACnDE,cAAgBvC,EAAE,iBAAiB,GACnCwC,eAAiBxC,EAAE,iBAAiB,GACpCyC,gBAAkBzC,EAAE,wBAAwB,GAElDA,EAAE0C,KAAKN,qBAAqBO,MAAK,SAASC,WACtCR,oBAAsBQ,gBAChBC,YAAcC,SAASC,cAAc,UACrCC,UAAYF,SAASC,cAAc,KACzCC,UAAUC,UAAY,0BACtBJ,YAAYK,YAAYF,WACxBH,YAAYI,UAAY,sBACxBJ,YAAYM,GAAK,4BACjBN,YAAYO,WAAahB,oBAEzBS,YAAYQ,QAAU,WAClBrD,EAAE,UAAUsD,OACZtD,EAAE,UAAUsD,OACRf,eAA8E,OAA7DA,cAAcgB,aAAa,+BAC5CvD,EAAEuC,eAAeiB,QAEjBhB,gBAAgF,OAA9DA,eAAee,aAAa,+BAC9CvD,EAAEwC,gBAAgBgB,QAElBxD,EAAE,yBAAyByD,OAAS,GAAKzD,EAAE,yBAAyB,GAAG,GAAG0D,SAC1E1D,EAAEyC,iBAAiBkB,SAAS,yBAEhC3D,EAAEyC,iBAAiBkB,SAAS,wBAC5BlB,gBAAgBmB,SAAS,GAAGC,MAAMpC,OAAS,OAC3CzB,EAAE,8BAA8BsD,OAChCtD,EAAE,6BAA6B8D,QAEnChB,SAASiB,cAAc,oBAAoBF,MAAMG,QAAU,eAC3DvB,gBAAgBwB,OAAOpB,gBAE3B7C,EAAE0C,KAAKJ,oBAAoBK,MAAK,SAASC,WACrCN,mBAAqBM,gBACfsB,WAAapB,SAASC,cAAc,UACpCoB,SAAWrB,SAASC,cAAc,KACxCoB,SAASlB,UAAY,4BACrBiB,WAAWhB,YAAYiB,UACvBD,WAAWd,WAAad,mBACxB4B,WAAWjB,UAAY,sBACvBiB,WAAWf,GAAK,2BAEhBe,WAAWb,QAAU,WACjBrD,EAAEyC,iBAAiB2B,YAAY,wBAC/BpE,EAAEyC,iBAAiB2B,YAAY,yBAC/B3B,gBAAgBmB,SAAS,GAAGC,MAAMpC,OAAS,OAC3CzB,EAAE,UAAU8D,OACZ9D,EAAE,UAAU8D,OACZ9D,EAAE,8BAA8B8D,OAChC9D,EAAE,6BAA6BsD,QAEnCtD,EAAE,mBAAmB,GAAGqE,QAAQH,YAChClE,EAAE,6BAA6BsD,UA4C3BgB"}