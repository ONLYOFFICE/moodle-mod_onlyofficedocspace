/**
 * @module mod_onlyofficedocspace/docspace_users
 * @copyright  2024 Ascensio System SIA <integration@onlyoffice.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 **/
define("mod_onlyofficedocspace/docspace_users",["jquery","mod_onlyofficedocspace/docspace_integration_sdk","mod_onlyofficedocspace/password_generator","mod_onlyofficedocspace/notification","core/str","core_form/changechecker","mod_onlyofficedocspace/repository"],(function($,DocSpaceIntegrationSDK,PasswordGenerator,Notification,Str,ChangeChecker,Repository){const selectors_inviteButton="button[data-action='invite-to-docspace']",selectors_usersTable="table[id='ds-invite-users-table']",selectors_selectAllUsers="input[data-action='select-all-users']",selectors_systemFrameId="ds-system-frame",toggle=function(event){const checked=event.target.checked,checkboxes=document.querySelector(selectors_usersTable).querySelectorAll('input[name="users"]');for(var i=0,n=checkboxes.length;i<n;i++)checkboxes[i].checked=checked},sendInvitations=async function(users){const docSpace=DocSpace.SDK.frames[selectors_systemFrameId],hashSettings=await docSpace.getHashSettings();for(let user of users){const hash=await docSpace.createHash(PasswordGenerator.generate(),hashSettings);user.hash=hash}await Repository.inviteUsers(users).then((()=>{window.location.reload()})).catch((error=>{console.log(error),inviteButton.removeAttribute("disabled")}))},inviteUsers=async function(){if(!DocSpaceIntegrationSDK.initialized())return void Notification.display(await Str.getString("docspaceunreachable","onlyofficedocspace"),"error");document.querySelector(selectors_inviteButton).setAttribute("disabled","");const checkboxes=document.getElementsByName("users");let users=[];for(var i=0,n=checkboxes.length;i<n;i++)checkboxes[i].checked&&users.push({id:checkboxes[i].value});DocSpace.SDK.frames[selectors_systemFrameId]?sendInvitations(users):DocSpace.SDK.initSystem({frameId:selectors_systemFrameId,events:{onAppReady:async function(){sendInvitations(users)},onAppError:function(){console.log("An error occured while initialising DocSpace Frame."),DocSpace.SDK.frames[selectors_systemFrameId].destroyFrame()}}})};return{init:async function(url){ChangeChecker.disableAllChecks(),await DocSpaceIntegrationSDK.initScript("oodsp-api-js",url);document.querySelector(selectors_selectAllUsers).addEventListener("click",toggle),inviteButton=document.querySelector(selectors_inviteButton),inviteButton.addEventListener("click",inviteUsers)}}}));

//# sourceMappingURL=docspace_users.min.js.map